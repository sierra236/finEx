"use strict";(globalThis.webpackChunk_clerk_clerk_js=globalThis.webpackChunk_clerk_clerk_js||[]).push([["237"],{4617:function(e,t,o){o.r(t),o.d(t,{__experimental_Checkout:()=>B});var r=o(8635),n=o(6620),a=o(3064),i=o(5631),c=o(9144),l=o(918),s=o(4462);let u=e=>e[0].toUpperCase()+e.slice(1),d=e=>{let{checkout:t}=e,{setIsOpen:o}=(0,i.useDrawerContext)();return(0,r.BX)(r.HY,{children:[(0,r.tZ)(i.Drawer.Body,{children:(0,r.BX)(a.Span,{elementDescriptor:a.descriptors.checkoutSuccessRoot,sx:e=>({margin:"auto",position:"relative",aspectRatio:"1/1",display:"grid",width:"100%",padding:e.space.$4,flexShrink:0}),children:[(0,r.tZ)(m,{scale:1}),(0,r.tZ)(m,{scale:.75}),(0,r.tZ)(m,{scale:.5}),(0,r.tZ)(a.Box,{elementDescriptor:a.descriptors.checkoutSuccessBadge,sx:e=>({margin:"auto",gridArea:"1/1",display:"flex",position:"relative",width:e.sizes.$16,height:e.sizes.$16,borderRadius:e.radii.$circle,backgroundImage:"linear-gradient(180deg, rgba(255, 255, 255, 0.30) 0%, rgba(0, 0, 0, 0.12) 50%, rgba(0, 0, 0, 0.30) 95.31%)",boxShadow:"0px 4px 12px 0px rgba(0, 0, 0, 0.35), 0px 1px 0px 0px rgba(255, 255, 255, 0.05) inset",":before":{content:'""',position:"absolute",inset:e.space.$1,borderRadius:e.radii.$circle,backgroundColor:e.colors.$colorBackground}}),children:(0,r.tZ)(a.Icon,{icon:s.Jr,colorScheme:"neutral",sx:{position:"relative",margin:"auto"},"aria-hidden":!0})}),(0,r.BX)(a.Span,{sx:e=>({margin:"auto",gridArea:"1/1",position:"relative",textAlign:"center",transform:"translateY(".concat(e.space.$20,")")}),children:[(0,r.tZ)(a.Heading,{elementDescriptor:a.descriptors.checkoutSuccessTitle,as:"h2",textVariant:"h2",children:"Payment was successful!"}),(0,r.tZ)(a.Text,{elementDescriptor:a.descriptors.checkoutSuccessDescription,colorScheme:"secondary",sx:e=>({textAlign:"center",paddingInline:e.space.$8,marginBlockStart:e.space.$2}),children:"Minim adipisicing enim fugiat enim est ad nisi exercitation nisi exercitation quis culpa."})]})]})}),(0,r.BX)(i.Drawer.Footer,{sx:e=>({rowGap:e.space.$4}),children:[(0,r.BX)(i.LineItems.Root,{children:[(0,r.BX)(i.LineItems.Group,{variant:"secondary",children:[(0,r.tZ)(i.LineItems.Title,{title:"Total paid"}),(0,r.tZ)(i.LineItems.Description,{text:t.invoice?"".concat(t.invoice.totals.grandTotal.currencySymbol).concat(t.invoice.totals.grandTotal.amountFormatted):"–"})]}),(0,r.BX)(i.LineItems.Group,{variant:"secondary",children:[(0,r.tZ)(i.LineItems.Title,{title:"Payment method"}),(0,r.tZ)(i.LineItems.Description,{text:t.paymentSource?"".concat(u(t.paymentSource.cardType)," ⋯ ").concat(t.paymentSource.last4):"–"})]}),(0,r.BX)(i.LineItems.Group,{variant:"tertiary",children:[(0,r.tZ)(i.LineItems.Title,{title:"Invoice ID"}),(0,r.tZ)(i.LineItems.Description,{text:t.invoice?t.invoice.id:"–",truncateText:!0,copyText:!0,copyLabel:"Copy invoice ID"})]})]}),(0,r.tZ)(a.Button,{onClick:()=>{o&&o(!1)},localizationKey:(0,a.localizationKeys)("formButtonPrimary")})]})]})};function m(e){let{scale:t}=e;return(0,r.tZ)(a.Span,{elementDescriptor:a.descriptors.checkoutSuccessRing,sx:e=>({margin:"auto",gridArea:"1/1",width:"".concat(100*t,"%"),height:"".concat(100*t,"%"),borderWidth:1,borderStyle:"solid",borderColor:e.colors.$neutralAlpha200,borderRadius:e.radii.$circle,maskImage:"linear-gradient(to bottom, transparent 15%, black, transparent 85%)"})})}var p=o(3799),h=o(5295),g=o(9241),y=o(4011);let x=e=>e[0].toUpperCase()+e.slice(1),S=e=>{let{checkout:t,onCheckoutComplete:o}=e,{plan:n,planPeriod:c,totals:l}=t;return(0,r.BX)(i.Drawer.Body,{children:[(0,r.tZ)(a.Box,{elementDescriptor:a.descriptors.checkoutFormLineItemsRoot,sx:e=>({padding:e.space.$4,borderBottomWidth:e.borderWidths.$normal,borderBottomStyle:e.borderStyles.$solid,borderBottomColor:e.colors.$neutralAlpha100}),children:(0,r.BX)(i.LineItems.Root,{children:[(0,r.BX)(i.LineItems.Group,{children:[(0,r.tZ)(i.LineItems.Title,{title:n.name}),(0,r.tZ)(i.LineItems.Description,{text:"".concat(n.currencySymbol," ").concat("month"===c?n.amountFormatted:n.annualMonthlyAmountFormatted),suffix:"per month".concat("annual"===c?", times 12 months":"")})]}),(0,r.BX)(i.LineItems.Group,{borderTop:!0,variant:"tertiary",children:[(0,r.tZ)(i.LineItems.Title,{title:"Subtotal"}),(0,r.tZ)(i.LineItems.Description,{text:"".concat(l.subtotal.currencySymbol," ").concat(l.subtotal.amountFormatted)})]}),(0,r.BX)(i.LineItems.Group,{variant:"tertiary",children:[(0,r.tZ)(i.LineItems.Title,{title:"Tax"}),(0,r.tZ)(i.LineItems.Description,{text:"".concat(l.taxTotal.currencySymbol," ").concat(l.taxTotal.amountFormatted)})]}),(0,r.BX)(i.LineItems.Group,{borderTop:!0,children:[(0,r.tZ)(i.LineItems.Title,{title:"Total".concat(l.totalDueNow?" Due Today":"")}),(0,r.tZ)(i.LineItems.Description,{text:"".concat(l.totalDueNow?"".concat(l.totalDueNow.currencySymbol).concat(l.totalDueNow.amountFormatted):"".concat(l.grandTotal.currencySymbol).concat(l.grandTotal.amountFormatted))})]})]})}),(0,r.tZ)(b,{checkout:t,onCheckoutComplete:o})]})},b=e=>{let{checkout:t,onCheckoutComplete:o}=e,{__experimental_commerce:s}=(0,p.cL)(),{organization:u}=(0,p.o8)(),{subscriberType:d}=(0,n.useCheckoutContext)(),[m,x]=(0,c.useState)(!0),[S,b]=(0,c.useState)(!0),[D,B]=(0,c.useState)(!1),[k,v]=(0,c.useState)(),{data:I}=(0,l.ib)(null==s?void 0:s.getPaymentSources,{..."org"===d?{orgId:null==u?void 0:u.id}:{}},void 0,"commerce-payment-sources"),{data:w}=I||{data:[]},T=async e=>{let{paymentSourceId:r}=e;return t.confirm({paymentSourceId:r,..."org"===d?{orgId:null==u?void 0:u.id}:{}}).then(e=>{o(e)}).catch(e=>{throw e})},C=async e=>{e.preventDefault(),B(!0),v(void 0);let t=new FormData(e.currentTarget).get("payment_source_id");try{await T({paymentSourceId:t})}catch(e){(0,g.S3)(e,[],v)}finally{B(!1)}},L=async e=>{await T({paymentSourceId:e.id})};return(0,r.BX)(a.Col,{elementDescriptor:a.descriptors.checkoutFormElementsRoot,gap:3,sx:e=>({padding:e.space.$4}),children:[k&&(0,r.tZ)(i.Alert,{variant:"danger",sx:e=>({animation:"".concat(h.animations.textInBig," ").concat(e.transitionDuration.$slow)}),children:"string"==typeof k?k:k.message}),w.length>0&&(0,r.BX)(r.HY,{children:[(0,r.BX)(i.Disclosure.Root,{open:m,onOpenChange:x,children:[(0,r.tZ)(i.Disclosure.Trigger,{text:"Account Funds"}),(0,r.tZ)(i.Disclosure.Content,{children:(0,r.tZ)(a.Col,{gap:3,children:(0,r.tZ)(Z,{checkout:t,paymentSources:w,totalDueNow:t.totals.totalDueNow||t.totals.grandTotal,onPaymentSourceSubmit:C,isSubmitting:D})})})]}),(0,r.tZ)(i.Divider,{})]}),(0,r.BX)(i.Disclosure.Root,{open:S,onOpenChange:b,children:[(0,r.tZ)(i.Disclosure.Trigger,{text:"Add a New Payment Source"}),(0,r.tZ)(i.Disclosure.Content,{children:(0,r.tZ)(n.__experimental_PaymentSourcesContext.Provider,{value:{componentName:"PaymentSources",subscriberType:d},children:(0,r.tZ)(y.M$,{checkout:t,onSuccess:L,submitLabel:(0,a.localizationKeys)("userProfile.__experimental_billingPage.paymentSourcesSection.formButtonPrimary__pay",{amount:"".concat((t.totals.totalDueNow||t.totals.grandTotal).currencySymbol).concat((t.totals.totalDueNow||t.totals.grandTotal).amountFormatted)})})})})]})]})},Z=e=>{let{checkout:t,totalDueNow:o,paymentSources:n,onPaymentSourceSubmit:l,isSubmitting:u}=e,[d,m]=(0,c.useState)(t.paymentSource||n.find(e=>e.isDefault)),p=(0,c.useMemo)(()=>n.map(e=>({value:e.id,label:"".concat(x(e.cardType)," ⋯ ").concat(e.last4)})),[n]);return(0,r.BX)(a.Form,{onSubmit:l,sx:e=>({display:"flex",flexDirection:"column",rowGap:e.space.$3}),children:[(0,r.BX)(i.Select,{elementId:"paymentSource",options:p,value:(null==d?void 0:d.id)||null,onChange:e=>{m(n.find(t=>t.id===e.value))},portal:!0,children:[(0,r.tZ)("input",{name:"payment_source_id",type:"hidden",value:null==d?void 0:d.id}),(0,r.tZ)(i.SelectButton,{icon:s.OG,sx:e=>({justifyContent:"space-between",backgroundColor:e.colors.$colorBackground}),children:d&&(0,r.tZ)(y.jr,{paymentSource:d})}),(0,r.tZ)(i.SelectOptionList,{sx:e=>({paddingBlock:e.space.$1,color:e.colors.$colorText})})]}),(0,r.BX)(a.Button,{type:"submit",colorScheme:"primary",size:"sm",textVariant:"buttonLarge",sx:{width:"100%"},isLoading:u,children:["Pay ",o.currencySymbol,o.amountFormatted]})]})},D=e=>{let{planId:t,planPeriod:o,subscriberType:n,onSubscriptionComplete:i}=e,{checkout:s,isLoading:u,invalidate:m,updateCheckout:p}=(0,l.Mg)({planId:t,planPeriod:o,subscriberType:n});return((0,c.useEffect)(()=>m,[]),u)?(0,r.tZ)(a.Spinner,{sx:{margin:"auto"}}):s?(null==s?void 0:s.status)==="completed"?(0,r.tZ)(d,{checkout:s}):(0,r.tZ)(S,{checkout:s,onCheckoutComplete:e=>{p(e),null==i||i()}}):(0,r.tZ)(r.HY,{children:(0,r.tZ)(a.Alert,{colorScheme:"danger",sx:{margin:"auto"},children:"There was a problem, please try again later."})})},B=e=>(0,r.tZ)(a.Flow.Root,{flow:"checkout",children:(0,r.tZ)(a.Flow.Part,{children:(0,r.tZ)(n.__experimental_CheckoutContext.Provider,{value:{componentName:"Checkout",...e},children:(0,r.BX)(i.Drawer.Content,{children:[(0,r.tZ)(i.Drawer.Header,{title:"Checkout"}),(0,r.tZ)(D,{...e})]})})})})}}]);